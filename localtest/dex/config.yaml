# Dex configuration for local testing
# See: https://dexidp.io/docs/

issuer: http://localhost:5556/dex

storage:
  type: sqlite3
  config:
    file: /var/dex/dex.db

web:
  http: 0.0.0.0:5556

# Enable telemetry
telemetry:
  http: 0.0.0.0:5558

# OAuth2 configuration
oauth2:
  skipApprovalScreen: true
  responseTypes: ["code", "token", "id_token"]

# Static clients for testing
staticClients:
  # Example application client
  - id: events-bridge-test
    redirectURIs:
      - "http://localhost:8080/callback"
      - "http://127.0.0.1:8080/callback"
    name: "Events Bridge Test"
    secret: ZXZlbnRzLWJyaWRnZS1zZWNyZXQ= # events-bridge-secret in base64

  # CLI tool for manual testing
  - id: cli-tool
    public: true
    redirectURIs:
      - "http://localhost:5555/callback"
      - "urn:ietf:wg:oauth:2.0:oob"
    name: "CLI Tool"

# Connectors - authentication backends
connectors:
  # Mock connector for easy testing
  - type: mockCallback
    id: mock
    name: Mock Login

  # Static password connector for testing
  - type: mockPassword
    id: mock-password
    name: Static Password
    config:
      username: "admin"
      password: "password"

# Static passwords for testing
# Password is bcrypt hash of "password"
staticPasswords:
  - email: "admin@example.com"
    hash: "$2a$10$2b2cU8CPhOTaGrs1HRQuAueS7JTT5ZHsHSzYiFPm1leZck7Mc8T4W"
    username: "admin"
    userID: "08a8684b-db88-4b73-90a9-3cd1661f5466"
  - email: "user@example.com"
    hash: "$2a$10$2b2cU8CPhOTaGrs1HRQuAueS7JTT5ZHsHSzYiFPm1leZck7Mc8T4W"
    username: "user"
    userID: "41331323-6f44-45e6-b3b9-2c4b60c02be5"

# Enable gRPC API (optional)
grpc:
  addr: 0.0.0.0:5557
  tlsCert: ""
  tlsKey: ""
  tlsClientCA: ""

# Frontend theme (optional)
frontend:
  theme: "light"
  issuer: "Events Bridge Dev"
  logoURL: ""

# Logging configuration
logger:
  level: "debug"
  format: "json"

# Expiry configuration
expiry:
  deviceRequests: "5m"
  signingKeys: "6h"
  idTokens: "24h"
  authRequests: "24h"
  refreshTokens:
    reuseInterval: "3s"
    validIfNotUsedFor: "2160h" # 90 days
    absoluteLifetime: "3960h" # 165 days
