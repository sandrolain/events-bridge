version: "3"

tasks:
  test-coap:
    cmds:
      - viddy go run ./coapclient 'localhost:5683' '/event' '{"test":123}'

  test-http:
    cmds:
      - 'viddy curl -X POST -H ''Content-Type: application/json'' -d ''{"test":123}'' ''http://localhost:8080/event'''

  test-nats:
    cmds:
      - viddy nats pub event.subject '{"test":123}' --server nats://localhost:4222

  gen-plugin-proto:
    dir: ./src/plugin/proto
    cmds:
      - protoc --proto_path=. --go_out=. --go_opt=paths=source_relative --go-grpc_out=. --go-grpc_opt=paths=source_relative ./plugin.proto

  build-testers:
    dir: ./testers
    cmds:
      - mkdir -p ./bin
      - go build -o ./bin/coapsource ./coapsource
      - go build -o ./bin/coaptarget ./coaptarget
      - go build -o ./bin/httptarget ./httptarget
      - go build -o ./bin/plugin ./plugin
