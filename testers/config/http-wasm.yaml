commands:
  - name: task
    cmd: "./bin/events-bridge"
    env:
      EB_CONFIG_CONTENT: |
        source:
          type: "http"
          options:
            address: "localhost:8080"
            method: "POST"
        runners:
          - type: "wasm"
            options:
              path: "./testers/bin/wasmrunner.wasm"
              mountPath: "./testers/runners/wasmrunner"
              env:
                FILE_NAME: "test1.txt"
            routines: 8
            ifExpr: 'string(metadata.path) matches "^/event$"'
          - type: "wasm"
            options:
              path: "./testers/bin/wasmrunner.wasm"
              mountPath: "./testers/runners/wasmrunner"
              env:
                FILE_NAME: "test2.txt"
            routines: 8
            ifExpr: 'string(metadata.path) matches "^/hook$"'
          - type: "pass"
            filterExpr: 'string(metadata["x-file"]) matches "test2"'
    args: []
    restartTries: 0
  - name: http-source-1
    cmd: "./testers/bin/httptool"
    args:
      [
        "send",
        "--interval",
        "1s",
        "--path",
        "/event",
        "--payload",
        "{counter} - {nowtime}",
      ]
    startAfter: "1500ms"
  - name: http-source-2
    cmd: "./testers/bin/httptool"
    args:
      [
        "send",
        "--interval",
        "1s",
        "--path",
        "/hook",
        "--payload",
        "{counter} - {nowtime}",
      ]
    startAfter: "2000ms"
killOthers: true
#enableTUI: true
